<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minhas Tarefas de Suporte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
    }

    .container {
      max-width: 900px;
      width: 100%;
      padding: 16px;
    }

    h1 {
      margin-top: 0;
      text-align: center;
    }

    .card {
      background: #111827;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    label {
      font-size: 0.85rem;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn-primary {
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
    }

    .btn-secondary {
      background: #1f2937;
      color: #e5e7eb;
    }

    .btn-danger {
      background: #b91c1c;
      color: #fee2e2;
    }

    .toolbar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .toolbar select {
      max-width: 150px;
    }

    .tasks {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 60vh;
      overflow-y: auto;
    }

    .task {
      background: #020617;
      border-radius: 10px;
      padding: 10px 12px;
      border-left: 4px solid #4b5563;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .task-title {
      font-weight: 600;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    .badge-status {
      background: #1f2937;
      color: #e5e7eb;
    }

    .badge-priority-Alta {
      background: #b91c1c;
      color: #fee2e2;
    }

    .badge-priority-MÃ©dia {
      background: #d97706;
      color: #fffbeb;
    }

    .badge-priority-Baixa {
      background: #065f46;
      color: #d1fae5;
    }

    .task-meta {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .task-actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .empty {
      text-align: center;
      color: #6b7280;
      font-size: 0.9rem;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Minhas Tarefas de Suporte</h1>

    <!-- FormulÃ¡rio -->
    <div class="card">
      <h2 style="margin-top:0; font-size:1.1rem;">Nova tarefa</h2>
      <div class="form-grid">
        <div>
          <label for="title">TÃ­tulo</label>
          <input id="title" placeholder="Ex: Trocar toner da Samsung 4070" />
        </div>
        <div>
          <label for="location">Setor / Local</label>
          <input id="location" placeholder="Ex: Secretaria, Tesouraria..." />
        </div>
        <div>
          <label for="priority">Prioridade</label>
          <select id="priority">
            <option value="MÃ©dia">MÃ©dia</option>
            <option value="Alta">Alta</option>
            <option value="Baixa">Baixa</option>
          </select>
        </div>
        <div>
          <label for="dueDate">Prazo</label>
          <input id="dueDate" type="date" />
        </div>
      </div>
      <div style="margin-top:8px;">
        <label for="description">DescriÃ§Ã£o</label>
        <textarea id="description" placeholder="Detalhes da tarefa (opcional)"></textarea>
      </div>
      <div style="margin-top:12px; display:flex; justify-content:flex-end;">
        <button class="btn-primary" id="addTaskBtn">Adicionar tarefa</button>
      </div>
    </div>

    <!-- Filtros -->
    <div class="card">
      <h2 style="margin-top:0; font-size:1.1rem;">Filtros</h2>
      <div class="toolbar">
        <div>
          <label>Status</label>
          <select id="filterStatus">
            <option value="todos">Todos</option>
            <option value="A fazer">A fazer</option>
            <option value="Em andamento">Em andamento</option>
            <option value="ConcluÃ­do">ConcluÃ­do</option>
          </select>
        </div>
        <div>
          <label>Prioridade</label>
          <select id="filterPriority">
            <option value="todas">Todas</option>
            <option value="Alta">Alta</option>
            <option value="MÃ©dia">MÃ©dia</option>
            <option value="Baixa">Baixa</option>
          </select>
        </div>
        <div>
          <label>Buscar por texto</label>
          <input id="filterText" placeholder="TÃ­tulo, descriÃ§Ã£o, local..." />
        </div>
      </div>
    </div>

    <!-- Lista de tarefas -->
    <div class="card">
      <h2 style="margin-top:0; font-size:1.1rem;">Tarefas</h2>
      <div class="tasks" id="tasksContainer"></div>
      <div class="empty" id="emptyState" style="display:none;">
        Nenhuma tarefa encontrada.
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "suporte_tarefas_v1";

    function loadTasks() {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : [];
    }

    function saveTasks(tasks) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(16).slice(2);
    }

    function addTask(task) {
      const tasks = loadTasks();
      tasks.unshift(task); // adiciona no topo
      saveTasks(tasks);
      renderTasks();
    }

    function updateTask(id, updates) {
      const tasks = loadTasks().map(t => t.id === id ? { ...t, ...updates } : t);
      saveTasks(tasks);
      renderTasks();
    }

    function deleteTask(id) {
      const tasks = loadTasks().filter(t => t.id !== id);
      saveTasks(tasks);
      renderTasks();
    }

    function formatDate(dateStr) {
      if (!dateStr) return "-";
      const [year, month, day] = dateStr.split("-");
      return `${day}/${month}/${year}`;
    }

    function renderTasks() {
      const container = document.getElementById("tasksContainer");
      const emptyState = document.getElementById("emptyState");
      container.innerHTML = "";

      const statusFilter = document.getElementById("filterStatus").value;
      const priorityFilter = document.getElementById("filterPriority").value;
      const textFilter = document.getElementById("filterText").value.toLowerCase();

      let tasks = loadTasks();

      tasks = tasks.filter(task => {
        let ok = true;

        if (statusFilter !== "todos" && task.status !== statusFilter) ok = false;
        if (priorityFilter !== "todas" && task.priority !== priorityFilter) ok = false;

        if (textFilter) {
          const blob = (
            task.title +
            " " +
            (task.description || "") +
            " " +
            (task.location || "")
          ).toLowerCase();
          if (!blob.includes(textFilter)) ok = false;
        }

        return ok;
      });

      if (!tasks.length) {
        emptyState.style.display = "block";
        return;
      } else {
        emptyState.style.display = "none";
      }

      tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "task";

        // cor da borda pela prioridade
        if (task.priority === "Alta") div.style.borderLeftColor = "#b91c1c";
        if (task.priority === "MÃ©dia") div.style.borderLeftColor = "#d97706";
        if (task.priority === "Baixa") div.style.borderLeftColor = "#047857";

        div.innerHTML = `
          <div class="task-header">
            <div>
              <div class="task-title">${task.title}</div>
              <div class="task-meta">
                ${task.location ? `Local: ${task.location} Â· ` : ""}Criada em: ${new Date(task.createdAt).toLocaleString("pt-BR")}
              </div>
            </div>
            <div style="display:flex; flex-direction:column; gap:4px; align-items:flex-end;">
              <span class="badge badge-status">${task.status}</span>
              <span class="badge badge-priority-${task.priority}">${task.priority}</span>
            </div>
          </div>
          ${task.description ? `<div class="task-meta" style="margin-top:4px;">${task.description}</div>` : ""}
          <div class="task-meta">Prazo: ${formatDate(task.dueDate || "")}</div>
        `;

        const actions = document.createElement("div");
        actions.className = "task-actions";

        if (task.status !== "A fazer") {
          const btnToDo = document.createElement("button");
          btnToDo.className = "btn-secondary";
          btnToDo.textContent = "Voltar p/ A fazer";
          btnToDo.onclick = () => updateTask(task.id, { status: "A fazer" });
          actions.appendChild(btnToDo);
        }

        if (task.status !== "Em andamento") {
          const btnDoing = document.createElement("button");
          btnDoing.className = "btn-secondary";
          btnDoing.textContent = "Em andamento";
          btnDoing.onclick = () => updateTask(task.id, { status: "Em andamento" });
          actions.appendChild(btnDoing);
        }

        if (task.status !== "ConcluÃ­do") {
          const btnDone = document.createElement("button");
          btnDone.className = "btn-primary";
          btnDone.textContent = "Concluir";
          btnDone.onclick = () => updateTask(task.id, { status: "ConcluÃ­do" });
          actions.appendChild(btnDone);
        }

        const btnDel = document.createElement("button");
        btnDel.className = "btn-danger";
        btnDel.textContent = "Excluir";
        btnDel.onclick = () => {
          if (confirm("Tem certeza que deseja excluir esta tarefa?")) {
            deleteTask(task.id);
          }
        };
        actions.appendChild(btnDel);

        div.appendChild(actions);
        container.appendChild(div);
      });
    }

    // Eventos
    document.getElementById("addTaskBtn").addEventListener("click", () => {
      const title = document.getElementById("title").value.trim();
      const location = document.getElementById("location").value.trim();
      const priority = document.getElementById("priority").value;
      const dueDate = document.getElementById("dueDate").value;
      const description = document.getElementById("description").value.trim();

      if (!title) {
        alert("Coloca pelo menos um tÃ­tulo na tarefa ðŸ˜Š");
        return;
      }

      const task = {
        id: generateId(),
        title,
        location,
        priority,
        dueDate,
        description,
        status: "A fazer",
        createdAt: new Date().toISOString()
      };

      addTask(task);

      // limpa formulÃ¡rio
      document.getElementById("title").value = "";
      document.getElementById("location").value = "";
      document.getElementById("description").value = "";
      document.getElementById("dueDate").value = "";
      document.getElementById("priority").value = "MÃ©dia";
    });

    ["filterStatus", "filterPriority", "filterText"].forEach(id => {
      document.getElementById(id).addEventListener("input", renderTasks);
    });

    document.addEventListener("DOMContentLoaded", renderTasks);
  </script>
</body>
</html>
